<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script defer data-domain="underoot.dev" src="https://stat2.underoot.dev/js/script.js"></script>
  <title>HEIC to 3D Viewer</title>
  <style>
    @import "tailwindcss";
    @import "@fortawesome/fontawesome-free/css/all.min.css";

    body {
      margin: 0
    }

    canvas {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #form {
      transition: transform 0.3s ease-in-out;
    }

    #form.folded {
      transform: translateY(-95%);
    }

    #form.folded .arrow {
      transform: rotate(180deg);
      transition: transform 0.3s ease-in-out;
    }

    #form .arrow {
      margin-top: 12px;
      transition: transform 0.3s ease-in-out;
      display: none;
      position: absolute;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    #form.folded .arrow {
      display: block;
    }

    #loader {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 50;
    }

    body.loading #loader {
      display: flex;
    }
  </style>
</head>
<body class="bg-gray-50 flex items-start justify-center min-h-screen p-6">
  <!-- Loader-->
  <div id="loader" class="fixed inset-0 bg-gray-900/50 flex items-center justify-center z-50">
    <div class="loader w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
  </div>
  <canvas id="canvas"></canvas>
  <div id="form" class="relative bg-white shadow-xl rounded-2xl p-8 pb-12 max-w-lg w-full relative">
    <button id="helpBtn" class="absolute top-4 right-4 text-blue-500 hover:text-blue-700 text-xl">
      <i class="fa-solid fa-circle-question"></i>
    </button>
    <h2 class="text-2xl font-semibold mb-4">HEIC Depth visualizer</h2>
    <p class="text-gray-600 mb-4">
      Upload a HEIC file with depth data to visualize it in 3D. 
      If you don't have a HEIC file, you can use the <span class="text-blue-500 cursor-pointer" id="helpBtn2">help</span> button to learn how to export one.
    </p>
    <input type="file" accept=".heic" id="depthInput" class="block text-sm text-gray-600
      file:mr-4 file:py-2 file:px-4
      file:rounded-lg file:border-0
      file:text-sm file:font-semibold
      file:bg-blue-100 file:text-blue-700
      hover:file:bg-blue-200
      cursor-pointer"/>
      <div class="arrow">
        <i class="fa-solid fa-arrow-up"></i>
      </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="flex items-center justify-center fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl max-w-2xl w-full shadow-lg p-6 relative">
      <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-lg">
        <i class="fa-solid fa-xmark"></i>
      </button>

      <h2 class="text-xl font-semibold mb-4">How to Export HEIC with Depth</h2>

      <div class="border-b mb-4">
        <nav class="flex space-x-4 text-sm font-medium" id="tabs">
          <button class="tab-button text-blue-600 border-b-2 border-blue-600 pb-2" data-tab="ios">iOS</button>
          <button class="tab-button text-gray-600 hover:text-blue-600 pb-2" data-tab="macos">macOS</button>
        </nav>
      </div>

      <div id="tab-content">
        <div class="tab-panel" data-tab="ios">
          <ul class="list-disc pl-6 text-gray-700 space-y-2">
            <li>Open the Camera app.</li>
            <li>Ensure "Portrait Mode" is selected.</li>
            <li>Take a photo.</li>
            <li>Open Photos app, find the portrait photo.</li>
            <li>Use the Share button and choose "Save to Files".</li>
            <li>Save as .HEIC and upload it here.</li>
          </ul>
        </div>
        <div class="tab-panel hidden" data-tab="macos">
          <ul class="list-disc pl-6 text-gray-700 space-y-2">
            <li>Connect your iPhone to your Mac.</li>
            <li>Open the Photos app on macOS.</li>
            <li>Find and export a portrait photo using "Export Unmodified Original".</li>
            <li>Make sure it's a .HEIC file with depth data.</li>
            <li>Upload it here.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="./index.ts"></script>
</body>
</html>